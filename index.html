<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#FFB6C1">
    <title>RoxyÁöÑÊØèÂë®ÊâìÂç°Ê∏ÖÂçï</title>
    <link rel="apple-touch-icon" href="icon-192x192.png">
    <link rel="manifest" href="manifest.json">
    <link href="https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #FF69B4;
            --secondary-color: #FFB6C1;
            --bg-color: #FFF0F5;
            --card-bg: #FFE4E1;
            --text-color: #4A4A4A;
            --shadow: 0 4px 8px rgba(255, 105, 180, 0.2);
            --safe-area-inset-top: env(safe-area-inset-top);
            --safe-area-inset-bottom: env(safe-area-inset-bottom);
        }

        * {
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        body {
            font-family: 'Comic Neue', cursive;
            text-align: center;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            padding-top: var(--safe-area-inset-top);
            padding-bottom: var(--safe-area-inset-bottom);
            min-height: 100vh;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(255, 182, 193, 0.2) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(255, 105, 180, 0.2) 0%, transparent 20%);
        }

        .container {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 25px;
            box-shadow: var(--shadow);
            margin-top: 20px;
            margin-bottom: 20px;
            border: 3px solid var(--secondary-color);
            position: relative;
        }

        .container::before {
            content: '‚ú®';
            position: absolute;
            top: -15px;
            left: -15px;
            font-size: 24px;
            animation: sparkle 2s infinite;
        }

        .container::after {
            content: '‚ú®';
            position: absolute;
            bottom: -15px;
            right: -15px;
            font-size: 24px;
            animation: sparkle 2s infinite 1s;
        }

        @keyframes sparkle {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        h2 {
            color: var(--primary-color);
            margin-bottom: 30px;
            font-size: 28px;
            line-height: 1.4;
            text-shadow: 2px 2px 4px rgba(255, 105, 180, 0.2);
            position: relative;
            display: inline-block;
        }

        h2::before, h2::after {
            content: 'üéÄ';
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
        }

        h2::before {
            left: -30px;
        }

        h2::after {
            right: -30px;
        }

        .day {
            margin: 20px 0;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 20px;
            transition: transform 0.2s;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            border: 2px dashed var(--primary-color);
            position: relative;
        }

        .day h3 {
            color: var(--primary-color);
            font-size: 22px;
            margin-bottom: 15px;
            text-shadow: 1px 1px 2px rgba(255, 105, 180, 0.2);
        }

        .day:active {
            transform: scale(0.98);
        }

        .task {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 18px;
            margin: 12px 0;
            padding: 15px;
            border-radius: 15px;
            background: white;
            box-shadow: 2px 2px 5px rgba(255, 105, 180, 0.1);
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            border: 2px solid transparent;
        }

        .task:active {
            background: #FFF0F5;
            border-color: var(--secondary-color);
        }

        .task.completed {
            background: #E8F5E9;
            border-color: #81C784;
        }

        .task span {
            flex: 1;
            text-align: left;
            margin-left: 10px;
            font-size: 16px;
        }

        input[type="checkbox"] {
            transform: scale(1.5);
            cursor: pointer;
            width: 24px;
            height: 24px;
            margin: 0 10px;
            -webkit-appearance: none;
            appearance: none;
            border: 2px solid var(--primary-color);
            border-radius: 50%;
            outline: none;
            transition: all 0.2s;
            position: relative;
        }

        input[type="checkbox"]:checked {
            background-color: var(--primary-color);
            animation: checkmark 0.3s ease-in-out;
        }

        @keyframes checkmark {
            0% { transform: scale(1); }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); }
        }

        input[type="checkbox"]:checked::after {
            content: '‚úì';
            position: absolute;
            color: white;
            font-size: 16px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .summary {
            margin-top: 30px;
            padding: 20px;
            font-size: 22px;
            color: var(--primary-color);
            background: var(--card-bg);
            border-radius: 20px;
            position: sticky;
            bottom: 20px;
            z-index: 100;
            border: 2px solid var(--secondary-color);
            box-shadow: 0 4px 8px rgba(255, 105, 180, 0.2);
        }

        .progress-bar {
            width: 100%;
            height: 24px;
            background: white;
            border-radius: 12px;
            margin: 15px 0;
            overflow: hidden;
            box-shadow: inset 0 2px 4px rgba(255, 105, 180, 0.2);
            border: 2px solid var(--secondary-color);
        }

        .progress {
            height: 100%;
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            transition: width 0.3s ease;
            border-radius: 12px;
            position: relative;
            overflow: hidden;
        }

        .progress::after {
            content: '‚ú®';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            font-size: 12px;
            animation: sparkle 1s infinite;
        }

        .reset-button {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 18px;
            margin-top: 20px;
            transition: all 0.2s;
            -webkit-tap-highlight-color: transparent;
            width: 80%;
            max-width: 300px;
            box-shadow: 0 4px 6px rgba(255, 105, 180, 0.3);
            font-family: 'Comic Neue', cursive;
            position: relative;
            overflow: hidden;
        }

        .reset-button:active {
            transform: scale(0.98);
            box-shadow: 0 2px 4px rgba(255, 105, 180, 0.2);
        }

        .reset-button::before {
            content: 'üéÄ';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        .reset-button::after {
            content: 'üéÄ';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
        }

        @media (max-width: 768px) {
            .container {
                width: 95%;
                padding: 15px;
                margin: 10px auto;
            }

            .task {
                font-size: 16px;
                padding: 12px;
            }

            .summary {
                font-size: 18px;
                padding: 15px;
            }

            h2 {
                font-size: 24px;
            }
        }

        @supports (-webkit-touch-callout: none) {
            .container {
                padding-bottom: calc(20px + var(--safe-area-inset-bottom));
            }
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            gap: 10px;
        }

        .nav-button {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
            -webkit-tap-highlight-color: transparent;
            flex: 1;
            box-shadow: 0 2px 4px rgba(255, 105, 180, 0.2);
            font-family: 'Comic Neue', cursive;
        }

        .nav-button:active {
            transform: scale(0.98);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 20px;
            width: 90%;
            max-width: 500px;
            position: relative;
            border: 3px solid var(--secondary-color);
        }

        .close-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--primary-color);
        }

        .emoji-picker {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 10px;
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
        }

        .emoji-option {
            font-size: 24px;
            padding: 10px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.2s;
        }

        .emoji-option:hover {
            background: var(--card-bg);
        }

        .custom-task-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .custom-task-form input {
            padding: 10px;
            border: 2px solid var(--secondary-color);
            border-radius: 10px;
            font-family: 'Comic Neue', cursive;
        }

        .custom-task-form button {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            color: white;
            border: none;
            padding: 10px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Comic Neue', cursive;
        }

        .task-list {
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .task-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: var(--card-bg);
            margin: 5px 0;
            border-radius: 10px;
        }

        .delete-task {
            color: #ff4444;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
        }

        .weekly-summary {
            display: none;
        }

        .summary-card {
            background: white;
            padding: 15px;
            border-radius: 15px;
            margin: 10px 0;
            border: 2px solid var(--secondary-color);
        }

        .summary-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .task-stats {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .stat-item {
            background: var(--card-bg);
            padding: 5px 10px;
            border-radius: 10px;
            font-size: 14px;
        }

        .day-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            overflow-x: auto;
            padding: 10px 0;
            -webkit-overflow-scrolling: touch;
        }

        .day-button {
            background: var(--card-bg);
            border: 2px solid var(--secondary-color);
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            white-space: nowrap;
            font-family: 'Comic Neue', cursive;
        }

        .day-button.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .day-progress {
            background: white;
            padding: 10px;
            border-radius: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-around;
            font-size: 18px;
            color: var(--primary-color);
            border: 2px solid var(--secondary-color);
        }
    </style>
</head>
<body>
    <div class="container">
        <h2>üåà RoxyÁöÑÊØèÂë®ÊâìÂç°Ê∏ÖÂçï / Roxy's Weekly Checklist üåà</h2>
        
        <div class="nav-buttons">
            <button class="nav-button" onclick="showCustomTaskModal()">Ê∑ªÂä†Êñ∞‰ªªÂä° / Add Task</button>
            <button class="nav-button" onclick="toggleWeeklySummary()">Âë®Ê±áÊÄª / Weekly Summary</button>
        </div>

        <div class="day-selector" id="daySelector">
            <!-- Days will be dynamically generated -->
        </div>

        <div id="days-container">
            <!-- Days will be dynamically generated -->
        </div>

        <div class="summary">
            <div>üåü ÊÄªËÆ°Ëé∑ÂæóË¥¥Á∫∏: <span id="totalStickers">0</span> / Total Stickers Earned: <span id="totalStickersEng">0</span> üåü</div>
            <div class="progress-bar">
                <div class="progress" id="progressBar"></div>
            </div>
            <button class="reset-button" onclick="resetWeek()">ÈáçÁΩÆÊú¨Âë® / Reset Week</button>
        </div>
    </div>

    <!-- Custom Task Modal -->
    <div class="modal" id="customTaskModal">
        <div class="modal-content">
            <button class="close-button" onclick="hideCustomTaskModal()">√ó</button>
            <h3>Ê∑ªÂä†Êñ∞‰ªªÂä° / Add New Task</h3>
            <div class="custom-task-form">
                <div>
                    <label>ÈÄâÊã©Ë°®ÊÉÖ / Choose Emoji:</label>
                    <div class="emoji-picker" id="emojiPicker">
                        <!-- Emojis will be dynamically generated -->
                    </div>
                </div>
                <input type="text" id="taskName" placeholder="ËæìÂÖ•‰ªªÂä°ÂêçÁß∞ / Enter task name">
                <div>
                    <label>
                        <input type="checkbox" id="taskOptional"> ÂèØÈÄâ‰ªªÂä° / Optional task
                    </label>
                </div>
                <button onclick="addCustomTask()">Ê∑ªÂä† / Add</button>
            </div>
            <div class="task-list" id="customTaskList">
                <!-- Custom tasks will be listed here -->
            </div>
        </div>
    </div>

    <!-- Weekly Summary -->
    <div class="modal" id="weeklySummaryModal">
        <div class="modal-content">
            <button class="close-button" onclick="hideWeeklySummary()">√ó</button>
            <h3>Êú¨Âë®Ê±áÊÄª / Weekly Summary</h3>
            <div id="weeklySummaryContent">
                <!-- Weekly summary will be generated here -->
            </div>
        </div>
    </div>

    <script>
        // Register Service Worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/roxy-checklist/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        const tasks = {
            weekday: [
                { icon: 'üìñ', name: 'ËØª‰π¶ / Reading', optional: false },
                { icon: '‚úèÔ∏è', name: '‰Ωú‰∏ö / Homework', optional: false },
                { icon: 'üéπ', name: 'ÁªÉÈí¢Áê¥ / Piano Practice', optional: false },
                { icon: 'üßπ', name: 'Êî∂Êãæ / Tidying Up', optional: false },
                { icon: 'üõí', name: 'ÈÄâÂÅöÔºöÂÆ∂Âä° / Optional: Chores', optional: true }
            ],
            weekend: [
                { icon: 'üìñ', name: 'ËØª‰π¶ / Reading', optional: false },
                { icon: '‚úèÔ∏è', name: '‰Ωú‰∏ö / Homework', optional: false },
                { icon: 'üéπ', name: 'ÁªÉÈí¢Áê¥ / Piano Practice', optional: false },
                { icon: 'üßπ', name: 'Êî∂Êãæ / Tidying Up', optional: false },
                { icon: 'üö¥', name: 'È™ëËá™Ë°åËΩ¶ / Cycling', optional: false },
                { icon: 'üèÉ', name: 'Ë∑ëÊ≠• / Running', optional: false },
                { icon: 'üèä', name: 'Ê∏∏Ê≥≥ÔºàÂèØÈÄâÔºâ / Swimming (Optional)', optional: true },
                { icon: 'üõí', name: 'ÈÄâÂÅöÔºöÂÆ∂Âä° / Optional: Chores', optional: true }
            ]
        };

        const days = ['ÊòüÊúü‰∏Ä / Monday', 'ÊòüÊúü‰∫å / Tuesday', 'ÊòüÊúü‰∏â / Wednesday', 
                     'ÊòüÊúüÂõõ / Thursday', 'ÊòüÊúü‰∫î / Friday', 'ÊòüÊúüÂÖ≠ / Saturday', 'ÊòüÊúüÊó• / Sunday'];

        let customTasks = JSON.parse(localStorage.getItem('customTasks') || '[]');
        let currentDay = new Date().getDay() - 1; // 0-6, Monday-Sunday

        function initializeApp() {
            const container = document.getElementById('days-container');
            const daySelector = document.getElementById('daySelector');
            
            // Initialize day selector
            daySelector.innerHTML = days.map((day, index) => `
                <button class="day-button ${index === currentDay ? 'active' : ''}" 
                        onclick="showDay(${index})">${day}</button>
            `).join('');
            
            // Show current day
            showDay(currentDay);
            
            loadProgress();
            setupEventListeners();
            setupTouchFeedback();
            updateCustomTaskList();
        }

        function showDay(index) {
            currentDay = index;
            const container = document.getElementById('days-container');
            container.innerHTML = createDayElement(days[index], index);
            
            // Update day selector
            document.querySelectorAll('.day-button').forEach((btn, i) => {
                btn.classList.toggle('active', i === index);
            });
            
            loadProgress();
            setupEventListeners();
            setupTouchFeedback();
        }

        function createDayElement(dayName, index) {
            const dayTasks = index < 5 ? tasks.weekday : tasks.weekend;
            const isFriday = index === 4;
            const allTasks = [...dayTasks, ...customTasks];
            
            return `
                <div class="day">
                    <h3>üìÖ ${dayName}</h3>
                    <div class="day-progress">
                        <div>‰ªäÊó•ÂÆåÊàê: <span class="day-completed">0</span>/${allTasks.length}</div>
                        <div>‰ªäÊó•Ë¥¥Á∫∏: <span class="day-stickers">0</span> üåü</div>
                    </div>
                    ${allTasks.map((task, taskIndex) => `
                        <div class="task" data-day="${index}" data-task="${taskIndex}">
                            ${task.icon} <span>${task.name}</span>
                            <input type="checkbox" class="taskDone" 
                                   ${(isFriday && taskIndex === 1) || task.optional ? 'data-optional="true"' : ''}> 
                            <span>Ë¥¥Á∫∏stickerüåü</span>
                            <input type="checkbox" class="stickerGiven"> 
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function showCustomTaskModal() {
            document.getElementById('customTaskModal').style.display = 'flex';
            generateEmojiPicker();
        }

        function hideCustomTaskModal() {
            document.getElementById('customTaskModal').style.display = 'none';
        }

        function generateEmojiPicker() {
            const emojiPicker = document.getElementById('emojiPicker');
            const commonEmojis = ['üìñ', '‚úèÔ∏è', 'üéπ', 'üßπ', 'üõí', 'üö¥', 'üèÉ', 'üèä', 'üé®', 'üéÆ', 'üéµ', 'üé∏', 'üéØ', 'üé™', 'üé≠', 'üé™', 'üé®', 'üé≠', 'üé™', 'üéØ', 'üéÆ', 'üé≤', 'üéØ', 'üé™', 'üé≠', 'üé®', 'üé™', 'üéØ', 'üéÆ', 'üé≤', 'üéØ', 'üé™'];
            emojiPicker.innerHTML = commonEmojis.map(emoji => `
                <div class="emoji-option" onclick="selectEmoji('${emoji}')">${emoji}</div>
            `).join('');
        }

        let selectedEmoji = 'üìù';

        function selectEmoji(emoji) {
            selectedEmoji = emoji;
            document.getElementById('taskName').focus();
        }

        function addCustomTask() {
            const taskName = document.getElementById('taskName').value.trim();
            const isOptional = document.getElementById('taskOptional').checked;
            
            if (taskName) {
                customTasks.push({
                    icon: selectedEmoji,
                    name: taskName,
                    optional: isOptional
                });
                
                localStorage.setItem('customTasks', JSON.stringify(customTasks));
                updateCustomTaskList();
                document.getElementById('taskName').value = '';
                document.getElementById('taskOptional').checked = false;
                showDay(currentDay);
            }
        }

        function updateCustomTaskList() {
            const taskList = document.getElementById('customTaskList');
            taskList.innerHTML = customTasks.map((task, index) => `
                <div class="task-item">
                    <span>${task.icon} ${task.name}</span>
                    <button class="delete-task" onclick="deleteCustomTask(${index})">√ó</button>
                </div>
            `).join('');
        }

        function deleteCustomTask(index) {
            customTasks.splice(index, 1);
            localStorage.setItem('customTasks', JSON.stringify(customTasks));
            updateCustomTaskList();
            showDay(currentDay);
        }

        function toggleWeeklySummary() {
            const modal = document.getElementById('weeklySummaryModal');
            if (modal.style.display === 'flex') {
                hideWeeklySummary();
            } else {
                showWeeklySummary();
            }
        }

        function showWeeklySummary() {
            const modal = document.getElementById('weeklySummaryModal');
            const content = document.getElementById('weeklySummaryContent');
            
            let summary = '';
            for (let i = 0; i < 7; i++) {
                const dayTasks = i < 5 ? tasks.weekday : tasks.weekend;
                const allTasks = [...dayTasks, ...customTasks];
                const completedTasks = getCompletedTasksForDay(i);
                
                summary += `
                    <div class="summary-card">
                        <div class="summary-header">
                            <h4>${days[i]}</h4>
                            <span>${completedTasks.length}/${allTasks.length} ÂÆåÊàê</span>
                        </div>
                        <div class="task-stats">
                            ${completedTasks.map(task => `
                                <div class="stat-item">${task.icon} ${task.name}</div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
            
            content.innerHTML = summary;
            modal.style.display = 'flex';
        }

        function hideWeeklySummary() {
            document.getElementById('weeklySummaryModal').style.display = 'none';
        }

        function getCompletedTasksForDay(dayIndex) {
            const progress = JSON.parse(localStorage.getItem('weeklyProgress') || '{"tasks":{},"stickers":{}}');
            const dayTasks = dayIndex < 5 ? tasks.weekday : tasks.weekend;
            const allTasks = [...dayTasks, ...customTasks];
            
            if (!progress.tasks[dayIndex]) return [];
            
            return allTasks.filter((_, index) => progress.tasks[dayIndex][index]);
        }

        function setupTouchFeedback() {
            document.querySelectorAll('.task').forEach(task => {
                task.addEventListener('touchstart', () => {
                    task.style.transform = 'scale(0.98)';
                });
                
                task.addEventListener('touchend', () => {
                    task.style.transform = 'scale(1)';
                });
            });
        }

        function setupEventListeners() {
            document.querySelectorAll('.taskDone').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    const task = e.target.closest('.task');
                    if (e.target.checked) {
                        task.classList.add('completed');
                        // Add haptic feedback if available
                        if (navigator.vibrate) {
                            navigator.vibrate(50);
                        }
                    } else {
                        task.classList.remove('completed');
                    }
                    updateProgress();
                });
            });

            document.querySelectorAll('.stickerGiven').forEach(checkbox => {
                checkbox.addEventListener('change', (e) => {
                    if (e.target.checked && navigator.vibrate) {
                        navigator.vibrate(100);
                    }
                    updateProgress();
                });
            });
        }

        function updateProgress() {
            const currentDayTasks = document.querySelectorAll(`.task[data-day="${currentDay}"]`);
            const completedTasks = document.querySelectorAll(`.task[data-day="${currentDay}"] .taskDone:checked`).length;
            const totalTasks = currentDayTasks.length;
            const dayStickers = document.querySelectorAll(`.task[data-day="${currentDay}"] .stickerGiven:checked`).length;
            
            // Update daily progress
            const dayElement = document.querySelector(`.day`);
            if (dayElement) {
                dayElement.querySelector('.day-completed').textContent = completedTasks;
                dayElement.querySelector('.day-stickers').textContent = dayStickers;
            }
            
            // Calculate total stickers for the entire week
            const progress = JSON.parse(localStorage.getItem('weeklyProgress') || '{"tasks":{},"stickers":{}}');
            let totalStickers = 0;
            
            // Count stickers for all days including current day
            for (let dayIndex = 0; dayIndex < 7; dayIndex++) {
                if (progress.stickers[dayIndex]) {
                    totalStickers += progress.stickers[dayIndex].filter(sticker => sticker).length;
                }
            }
            
            // Add current day's stickers if they haven't been saved yet
            if (dayStickers > 0) {
                const currentStickers = progress.stickers[currentDay] || [];
                const currentStickerCount = currentStickers.filter(sticker => sticker).length;
                if (dayStickers > currentStickerCount) {
                    totalStickers += (dayStickers - currentStickerCount);
                }
            }
            
            document.getElementById('totalStickers').textContent = totalStickers;
            document.getElementById('totalStickersEng').textContent = totalStickers;
            
            const progressPercent = (completedTasks / totalTasks) * 100;
            document.getElementById('progressBar').style.width = `${progressPercent}%`;
            
            saveProgress();
        }

        function saveProgress() {
            const progress = JSON.parse(localStorage.getItem('weeklyProgress') || '{"tasks":{},"stickers":{}}');
            
            // Save progress for current day
            progress.tasks[currentDay] = Array.from(document.querySelectorAll(`.task[data-day="${currentDay}"] .taskDone`))
                .map(cb => cb.checked);
            
            progress.stickers[currentDay] = Array.from(document.querySelectorAll(`.task[data-day="${currentDay}"] .stickerGiven`))
                .map(cb => cb.checked);
            
            progress.lastUpdated = new Date().toISOString();
            localStorage.setItem('weeklyProgress', JSON.stringify(progress));
        }

        function loadProgress() {
            const savedProgress = localStorage.getItem('weeklyProgress');
            if (savedProgress) {
                const progress = JSON.parse(savedProgress);
                
                // Load progress for current day only
                const dayTasks = currentDay < 5 ? tasks.weekday : tasks.weekend;
                const allTasks = [...dayTasks, ...customTasks];
                
                if (progress.tasks[currentDay]) {
                    document.querySelectorAll(`.task[data-day="${currentDay}"] .taskDone`).forEach((cb, i) => {
                        cb.checked = progress.tasks[currentDay][i];
                        if (progress.tasks[currentDay][i]) {
                            cb.closest('.task').classList.add('completed');
                        }
                    });
                }
                
                if (progress.stickers[currentDay]) {
                    document.querySelectorAll(`.task[data-day="${currentDay}"] .stickerGiven`).forEach((cb, i) => {
                        cb.checked = progress.stickers[currentDay][i];
                    });
                }
                
                updateProgress();
            }
        }

        function resetWeek() {
            if (confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆÊú¨Âë®ÁöÑËøõÂ∫¶ÂêóÔºü/ Are you sure you want to reset this week?')) {
                const progress = JSON.parse(localStorage.getItem('weeklyProgress') || '{"tasks":{},"stickers":{}}');
                
                // Only reset tasks for current day, keep stickers
                if (progress.tasks[currentDay]) {
                    progress.tasks[currentDay] = progress.tasks[currentDay].map(() => false);
                }
                
                // Save the updated progress
                localStorage.setItem('weeklyProgress', JSON.stringify(progress));
                
                // Update UI for current day
                document.querySelectorAll(`.task[data-day="${currentDay}"] .taskDone`)
                    .forEach(cb => cb.checked = false);
                document.querySelectorAll(`.task[data-day="${currentDay}"]`).forEach(task => 
                    task.classList.remove('completed'));
                
                // Update progress display
                updateProgress();
                
                if (navigator.vibrate) {
                    navigator.vibrate([50, 50, 50]);
                }
            }
        }

        // Initialize the app
        initializeApp();
    </script>
</body>
</html> 